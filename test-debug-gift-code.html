<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêû Debug - C√≥digo de Presente</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .success {
            color: green;
            font-weight: bold;
        }

        .error {
            color: red;
            font-weight: bold;
        }

        .warning {
            color: orange;
            font-weight: bold;
        }

        .info {
            color: blue;
        }

        button {
            background: #583819;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #4a2f15;
        }

        .log {
            background: #f8f8f8;
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üêû Debug - Problema do C√≥digo de Presente</h1>

        <div class="test-section">
            <h3>üîç Teste de Funcionalidade</h3>
            <p><strong>Problema:</strong> Ao clicar em "Criar Conta" no modal do c√≥digo de presente, redireciona para
                landing em vez de mostrar cadastro.</p>

            <h4>üìã Checklist de Verifica√ß√£o:</h4>
            <div id="checklist">
                <div>‚úÖ Fun√ß√£o closeGiftCodeWelcomeModal corrigida</div>
                <div>‚úÖ showRegisterForGiftCode corrigida para n√£o redirecionar</div>
                <div>‚úÖ Event listeners de modal protegidos</div>
                <div>‚ùì Testando se ainda h√° outros redirecionamentos...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üß™ Testes Simulados</h3>
            <button onclick="testFunction1()">Testar closeGiftCodeWelcomeModal(false)</button>
            <button onclick="testFunction2()">Testar showRegisterForGiftCode</button>
            <button onclick="testFunction3()">Simular Click no Modal</button>
            <button onclick="testFullFlow()">üî• Teste Completo do Fluxo</button>

            <div id="testResults" class="log">Clique nos bot√µes acima para testar...</div>
        </div>

        <div class="test-section">
            <h3>üéØ URLs de Teste</h3>
            <p>Para testar localmente:</p>
            <ul>
                <li><a href="http://localhost:3000/analisar.html?giftCode=TESTE123" target="_blank">Local - Com c√≥digo
                        TESTE123</a></li>
                <li><a href="http://localhost:8080/analisar.html?giftCode=ADMIN123" target="_blank">Local (8080) - Com
                        c√≥digo ADMIN123</a></li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üìã Debug Log Din√¢mico</h3>
            <div id="debugLog" class="log">Aguardando informa√ß√µes...</div>
        </div>
    </div>

    <script>
        let logArea = document.getElementById('testResults');
        let debugLog = document.getElementById('debugLog');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#007bff'
            };

            logArea.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span>\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        function debugInfo(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<span style="color: #007bff">[${timestamp}] ${message}</span>\n`;
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        // Override console.log para capturar logs da p√°gina
        const originalLog = console.log;
        console.log = function (...args) {
            originalLog.apply(console, args);
            debugInfo('CONSOLE: ' + args.join(' '));
        };

        // Detectar mudan√ßas de URL
        let currentUrl = window.location.href;
        setInterval(() => {
            if (window.location.href !== currentUrl) {
                debugInfo(`üîÑ URL MUDOU: ${currentUrl} ‚Üí ${window.location.href}`);
                currentUrl = window.location.href;
            }
        }, 100);

        function testFunction1() {
            log('üß™ Testando closeGiftCodeWelcomeModal(false)...', 'info');

            // Simular fun√ß√£o
            try {
                // Verificar se fun√ß√£o existe
                if (typeof window.closeGiftCodeWelcomeModal === 'function') {
                    log('‚úÖ Fun√ß√£o closeGiftCodeWelcomeModal existe', 'success');
                    log('üìù Parametro padr√£o deveria ser false agora', 'info');
                } else {
                    log('‚ùå Fun√ß√£o closeGiftCodeWelcomeModal N√ÉO encontrada', 'error');
                }
            } catch (e) {
                log('‚ùå Erro ao testar fun√ß√£o: ' + e.message, 'error');
            }
        }

        function testFunction2() {
            log('üß™ Testando showRegisterForGiftCode...', 'info');

            try {
                if (typeof window.showRegisterForGiftCode === 'function') {
                    log('‚úÖ Fun√ß√£o showRegisterForGiftCode existe', 'success');
                    log('üìù Deve chamar closeGiftCodeWelcomeModal(false)', 'info');
                } else {
                    log('‚ùå Fun√ß√£o showRegisterForGiftCode N√ÉO encontrada', 'error');
                }
            } catch (e) {
                log('‚ùå Erro ao testar fun√ß√£o: ' + e.message, 'error');
            }
        }

        function testFunction3() {
            log('üß™ Simulando click no modal...', 'info');

            // Verificar se temos localStorage com contexto de gift code
            const pendingCode = localStorage.getItem('pendingGiftCode');
            const isGiftCodeUser = localStorage.getItem('isGiftCodeUser');

            log(`üéÅ pendingGiftCode: ${pendingCode || 'null'}`, 'info');
            log(`üë§ isGiftCodeUser: ${isGiftCodeUser || 'null'}`, 'info');

            if (pendingCode || isGiftCodeUser) {
                log('‚úÖ Contexto de gift code detectado', 'success');
            } else {
                log('‚ö†Ô∏è Sem contexto de gift code', 'warning');
            }
        }

        function testFullFlow() {
            log('üî• TESTE COMPLETO DO FLUXO', 'warning');
            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'info');

            // 1. Simular URL com gift code
            log('1Ô∏è‚É£ Simulando acesso a analisar.html?giftCode=TESTE123', 'info');

            // 2. Simular localStorage
            localStorage.setItem('pendingGiftCode', 'TESTE123');
            localStorage.setItem('isGiftCodeUser', 'true');
            log('2Ô∏è‚É£ localStorage configurado com c√≥digo TESTE123', 'info');

            // 3. Verificar prote√ß√µes dos modais
            log('3Ô∏è‚É£ Verificando prote√ß√µes implementadas...', 'info');

            // Simular detec√ß√£o de formul√°rio de cadastro
            const mockRegisterForm = { style: { display: 'block' } };
            const isRegisterVisible = mockRegisterForm.style.display !== 'none';
            const hasGiftCodeContext = localStorage.getItem('pendingGiftCode') || localStorage.getItem('isGiftCodeUser');

            if (isRegisterVisible && hasGiftCodeContext) {
                log('‚úÖ Condi√ß√µes de prote√ß√£o ATIVAS - n√£o deve redirecionar', 'success');
            } else {
                log('‚ùå Condi√ß√µes de prote√ß√£o N√ÉO ativas', 'error');
            }

            log('4Ô∏è‚É£ Resultado esperado: Modal de cadastro aberto, sem redirecionamento', 'info');
            log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'info');

            setTimeout(() => {
                log('üéØ TESTE CONCLU√çDO - Verifique os resultados acima', 'success');
            }, 1000);
        }

        // Inicializar
        debugInfo('üöÄ Debug iniciado - Monitorando redirecionamentos...');

        // Detectar se estamos em uma p√°gina com gift code
        const urlParams = new URLSearchParams(window.location.search);
        const giftCode = urlParams.get('giftCode');
        if (giftCode) {
            debugInfo(`üéÅ C√≥digo de presente detectado na URL: ${giftCode}`);
        }
    </script>
</body>

</html>