<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Currículo - CV Sem Frescura</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Estilos do onboarding -->
    <link rel="stylesheet" href="/assets/css/onboarding.css">
    
    <style>
        :root {
            --primary: #583819;
            --primary-dark: #512808;
            --background: #F3EADA;
            --card-bg: #FFFCF9;
            --white: #FFFFFF;
            --text-dark: #583819;
            --text-gray: #505050;
            --border-color: #D1D1D1;
            --selected-file-bg: #ECD9B5;
            --border-radius: 10px;
            --shadow: 0px 4px 6px rgba(33, 33, 33, 0.04);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background-color: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo-container {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 20px 0;
            position: relative;
        }

        .logo {
            height: auto;
            max-height: 150px;
            width: auto;
            max-width: 80%;
        }

        /* User menu container and menu styles */
        .user-menu-container {
            position: absolute;
            right: 50px;
            top: 20px;
        }
        
        .auth-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .login-link {
            background-color: var(--primary);
            color: white;
            padding: 8px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: background-color 0.3s;
            display: inline-block;
        }
        
        .login-link:hover {
            background-color: var(--primary-dark);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: var(--primary);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            position: relative;
        }
        
        .user-name {
            max-width: 120px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .credits-badge {
            background-color: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            margin: 0 5px;
            cursor: help;
            position: relative;
        }
        
        .credits-badge:hover::after {
            content: "Cada análise é feita individualmente e permite até 8 links de vagas.";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: normal;
            white-space: nowrap;
            z-index: 200;
            margin-top: 5px;
            width: max-content;
            max-width: 200px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .dropdown-icon {
            font-size: 10px;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;             /* Posiciona exatamente abaixo do elemento pai */
            right: 0;              /* Alinhado à direita do elemento pai */
            margin-top: 2px;       /* Pequeno espaço apenas com margin */
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            min-width: 180px;
            z-index: 100;
        }
        
        .user-menu:hover + .dropdown-menu,
        .dropdown-menu:hover {
            display: flex;
        }
        
        .dropdown-item {
            display: block;
            padding: 4px 10px;
            color: var(--text-dark);
            text-decoration: none;
            transition: background-color 0.3s;
            font-size: 14px;
        }
        
        .dropdown-item:hover {
            background-color: #f5f5f5;
        }
        
        .dropdown-item.logout-btn {
            color: #d32f2f;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .login-link {
                position: static;
                display: block;
                width: fit-content;
                margin: 10px auto 0;
                transform: none;
            }
            
            .user-menu {
                position: relative;
                margin: 10px auto;
            }
            
            .dropdown-menu {
                position: absolute;
                width: 220px;
                left: 50%;
                transform: translateX(-50%);
            }
        }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="/assets/img/logo.png" alt="Logo Análise de Currículo" class="logo">
    </div>
    
    <!-- Conteúdo principal da página aqui -->
    <div class="container">
        <h1>CV Sem Frescura</h1>
        <h2>Otimize seu currículo com inteligência artificial.</h2>
        
        <div id="fileUploadSection">
            <h3>Selecione Seu Currículo</h3>
            <p>Ou arraste e solte seu currículo nesse campo</p>
            <button id="selectFileBtn">Selecionar Arquivo</button>
            <input type="file" id="fileInput" style="display: none;" accept=".pdf,.doc,.docx">
            <div id="selectedFile" class="selected-file">
                <span class="file-name"></span>
                <button class="remove-file">×</button>
            </div>
        </div>
        
        <div id="jobLinksSection">
            <h3>Link das Vagas Desejadas</h3>
            <div id="jobLinksContainer">
                <div class="job-link-item">
                    <input type="url" class="job-link-input" placeholder="https://linkdavaga.com">
                </div>
            </div>
            <button id="addJobLinkBtn">+ Adicionar Mais Uma Vaga</button>
        </div>
        
        <button id="analyzeBtn" class="analyze-btn">Analise Agora Seu Currículo</button>
    </div>
    
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Análise de Currículo com IA</h3>
                <p>Aproveite a inteligência artificial para identificar melhorias e alinhar seu perfil às exigências das vagas.</p>
            </div>
            
            <div class="footer-section">
                <h3>Feedback Personalizado</h3>
                <p>Descubra em segundos os pontos que podem destacar seu currículo no mercado.</p>
            </div>
            
            <div class="footer-section">
                <h3>Otimização Para Cada Vaga</h3>
                <p>Adapte seu currículo às expectativas dos recrutadores e aumente suas chances de sucesso.</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="brand">RH Super</div>
            <div class="copyright">© 2025 CV Sem Frescura. Todos os direitos reservados.</div>
            <div class="links-section">
                <a href="#">Políticas de Privacidade</a>
                <a href="#">Termos de Uso</a>
                <a href="#">Contato</a>
            </div>
        </div>
    </footer>
    
    <script>
    // Variáveis globais
    var addJobLinkBtn = document.getElementById('addJobLinkBtn');
    var jobLinksContainer = document.getElementById('jobLinksContainer');
    var analyzeBtn = document.getElementById('analyzeBtn');
    var logoutButton = document.getElementById('logoutButton');

    // Função para adicionar um novo campo de vaga
    function addJobLinkField() {
        const currentCount = jobLinksContainer.querySelectorAll('input.job-link-input').length;
        if (currentCount >= 7) {
            alert('Você atingiu o limite máximo de 7 vagas para análise simultânea.');
            return;
        }
        const newLinkItem = document.createElement('div');
        newLinkItem.className = 'job-link-item';
        newLinkItem.style.display = 'flex';
        newLinkItem.style.alignItems = 'center';
        const newInput = document.createElement('input');
        newInput.type = 'url';
        newInput.className = 'job-link-input';
        newInput.placeholder = `https://linkdavaga.com`;
        newLinkItem.appendChild(newInput);
        jobLinksContainer.appendChild(newLinkItem);
        newInput.focus();
    }

    // Event listener para adicionar vaga
    if (addJobLinkBtn) {
        addJobLinkBtn.addEventListener('click', addJobLinkField);
    }

    // Event listener para análise
    if (analyzeBtn) {
        analyzeBtn.addEventListener('click', function() {
            const fileInput = document.getElementById('fileInput');
            const jobLinkInputs = document.querySelectorAll('.job-link-input');
            const selectedFile = fileInput && fileInput.files.length > 0 ? fileInput.files[0] : null;
            const jobLinks = Array.from(jobLinkInputs).map(input => input.value.trim()).filter(Boolean);

            // Validação de URL
            const urlRegex = /^(https?:\/\/)[\w\-]+(\.[\w\-]+)+([\w.,@?^=%&:/~+#\-]*[\w@?^=%&/~+#\-])?$/i;
            const invalidLink = jobLinks.find(link => !urlRegex.test(link));
            if (invalidLink) {
                let msgDiv = document.getElementById('stepFeedback');
                if (!msgDiv) {
                    msgDiv = document.createElement('div');
                    msgDiv.id = 'stepFeedback';
                    msgDiv.textContent = '';
                    msgDiv.style.color = '';
                    msgDiv.style.fontWeight = 'bold';
                    msgDiv.style.margin = '10px 0 0 0';
                    analyzeBtn.parentNode.insertBefore(msgDiv, analyzeBtn.nextSibling);
                }
                msgDiv.textContent = 'O link informado não é válido: ' + invalidLink;
                return;
            }

            if (jobLinks.length === 0) {
                let msgDiv = document.getElementById('stepFeedback');
                if (!msgDiv) {
                    msgDiv = document.createElement('div');
                    msgDiv.id = 'stepFeedback';
                    msgDiv.textContent = '';
                    msgDiv.style.color = '';
                    msgDiv.style.fontWeight = 'bold';
                    msgDiv.style.margin = '10px 0 0 0';
                    analyzeBtn.parentNode.insertBefore(msgDiv, analyzeBtn.nextSibling);
                }
                msgDiv.textContent = 'Informe pelo menos um link de vaga para análise.';
                return;
            }

            // Limpar mensagens anteriores
            let msgDiv = document.getElementById('stepFeedback');
            if (!msgDiv) {
                msgDiv = document.createElement('div');
                msgDiv.id = 'stepFeedback';
                msgDiv.style.color = '#c62828';
                msgDiv.style.fontWeight = 'bold';
                msgDiv.style.margin = '10px 0 0 0';
                analyzeBtn.parentNode.insertBefore(msgDiv, analyzeBtn.nextSibling);
            }
            msgDiv.textContent = '';
            msgDiv.style.color = '';

            // Ler arquivo como base64
            var reader = new FileReader();
            reader.onload = function(e) {
                var fileContentBase64 = e.target.result;
                try {
                    sessionStorage.setItem('atsFile', selectedFile.name);
                    sessionStorage.setItem('atsFileContent', fileContentBase64);
                    sessionStorage.setItem('atsJobLinks', JSON.stringify(jobLinks));
                    setTimeout(function() {
                        window.location.href = 'loading.html';
                    }, 400);
                } catch (err) {
                    msgDiv.style.color = '#c62828';
                    msgDiv.textContent = 'Erro ao salvar dados para análise. Tente novamente.';
                }
            };
            reader.onerror = function() {
                msgDiv.style.color = '#c62828';
                msgDiv.textContent = 'Erro ao ler o arquivo. Tente outro formato.';
            };
            reader.readAsDataURL(selectedFile);
        });
    }

    // Event listener para logout
    if (logoutButton) {
        logoutButton.addEventListener('click', function(e) {
            e.preventDefault();
            if (window.logout) {
                window.logout();
            }
        });
    }

    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        const selectFileBtn = document.getElementById('selectFileBtn');
        const fileInput = document.getElementById('fileInput');
        const selectedFileDiv = document.getElementById('selectedFile');
        const fileNameSpan = selectedFileDiv.querySelector('.file-name');
        const removeFileBtn = selectedFileDiv.querySelector('.remove-file');
        
        // Inicialmente ocultar o componente
        selectedFileDiv.style.display = 'none';
        
        if (selectFileBtn && fileInput) {
            selectFileBtn.addEventListener('click', function(e) {
                fileInput.click();
            });
        }
        
        // Exibir nome do arquivo ao selecionar
        fileInput.addEventListener('change', function(e) {
            if (fileInput.files && fileInput.files.length > 0) {
                fileNameSpan.textContent = fileInput.files[0].name;
                selectedFileDiv.style.display = 'flex';
                removeFileBtn.style.display = 'inline-block';
            } else {
                selectedFileDiv.style.display = 'none';
            }
        });
        
        // Remover arquivo
        removeFileBtn.addEventListener('click', function() {
            fileInput.value = '';
            selectedFileDiv.style.display = 'none';
        });
        
        // Verificar autenticação
        function updateUI() {
            if (window.isAuthenticated && window.isAuthenticated()) {
                const userData = window.getUserData();
                // Lógica para usuário autenticado
            }
        }
        
        // Chamar updateUI quando a página carregar
        updateUI();
        
        // Verificar autenticação novamente após um pequeno atraso
        setTimeout(updateUI, 100);
    });
    </script>
</body>
</html>
