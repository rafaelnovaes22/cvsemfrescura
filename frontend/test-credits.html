<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Prote√ß√£o de Cr√©ditos</title>
    <link rel="stylesheet" href="assets/css/header.css">
    <style>
        body {
            font-family: Inter, sans-serif;
            background: #faf9f7;
            margin: 0;
            padding: 100px 20px 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .test-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 15px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
        }

        .btn-primary {
            background: #583819;
            color: white;
        }

        .btn-secondary {
            background: #f4f0ea;
            color: #583819;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
        }

        .analyze-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        #testAnalyzeBtn {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <!-- Header ser√° carregado dinamicamente -->

    <div class="container">
        <h1>üß™ Teste de Prote√ß√£o de Cr√©ditos</h1>
        <p>Esta p√°gina testa se as prote√ß√µes contra usu√°rios sem cr√©ditos est√£o funcionando corretamente.</p>

        <div class="test-section">
            <h3>üîß Controles de Teste</h3>
            <div class="test-controls">
                <button class="btn btn-secondary" onclick="simulateNoCredits()">
                    Simular 0 Cr√©ditos
                </button>
                <button class="btn btn-secondary" onclick="simulateWithCredits()">
                    Simular Com Cr√©ditos
                </button>
                <button class="btn btn-secondary" onclick="simulateLogout()">
                    Simular Logout
                </button>
                <button class="btn btn-primary" onclick="refreshInterface()">
                    Atualizar Interface
                </button>
            </div>

            <div id="status-display">
                <div class="status" id="current-status">
                    Aguardando verifica√ß√£o...
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üë§ Estado do Usu√°rio</h3>
            <ul id="user-info">
                <li>Status: <span id="auth-status">Verificando...</span></li>
                <li>Cr√©ditos: <span id="credits-count">-</span></li>
                <li>C√≥digo de presente: <span id="gift-code-status">-</span></li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üîí Teste de An√°lise</h3>
            <div class="analyze-section">
                <p>Bot√£o de an√°lise abaixo deve mudar para "Comprar Cr√©ditos" se usu√°rio n√£o tem cr√©ditos:</p>
                <button id="testAnalyzeBtn" class="btn btn-primary">
                    Analisar Curr√≠culo
                </button>
                <div id="analyze-result" style="margin-top: 10px;"></div>
            </div>
        </div>
    </div>

    <script src="assets/js/auth.js"></script>
    <script src="assets/js/header.js"></script>

    <script>
        // Simular usu√°rio sem cr√©ditos
        function simulateNoCredits() {
            const user = { name: 'Usu√°rio Teste', email: 'teste@teste.com', credits: 0 };
            localStorage.setItem('user', JSON.stringify(user));
            localStorage.setItem('token', 'fake-token');
            localStorage.removeItem('isGiftCodeUser');
            updateStatus('Simulando usu√°rio com 0 cr√©ditos', 'warning');
            refreshInterface();
        }

        // Simular usu√°rio com cr√©ditos
        function simulateWithCredits() {
            const user = { name: 'Usu√°rio Teste', email: 'teste@teste.com', credits: 5 };
            localStorage.setItem('user', JSON.stringify(user));
            localStorage.setItem('token', 'fake-token');
            localStorage.removeItem('isGiftCodeUser');
            updateStatus('Simulando usu√°rio com 5 cr√©ditos', 'success');
            refreshInterface();
        }

        // Simular logout
        function simulateLogout() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            localStorage.removeItem('isGiftCodeUser');
            updateStatus('Simulando logout', 'error');
            refreshInterface();
        }

        // Atualizar interface
        function refreshInterface() {
            if (window.headerManager) {
                window.headerManager.refreshUserInterface();
            }
            if (window.updateAnalyzeButton) {
                window.updateAnalyzeButton();
            }
            updateUserInfo();
            setTimeout(() => {
                checkAnalyzeButtonState();
            }, 200);
        }

        // Atualizar status
        function updateStatus(message, type) {
            const statusEl = document.getElementById('current-status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        // Atualizar informa√ß√µes do usu√°rio
        function updateUserInfo() {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            const token = localStorage.getItem('token');
            const isGiftCode = localStorage.getItem('isGiftCodeUser') === 'true';

            document.getElementById('auth-status').textContent =
                (user && token) ? 'Logado' : 'N√£o logado';
            document.getElementById('credits-count').textContent =
                user ? user.credits || 0 : '-';
            document.getElementById('gift-code-status').textContent =
                isGiftCode ? 'Sim' : 'N√£o';
        }

        // Verificar estado do bot√£o de an√°lise        function checkAnalyzeButtonState() {            const btn = document.getElementById('testAnalyzeBtn');            const resultDiv = document.getElementById('analyze-result');            if (btn.disabled) {                resultDiv.innerHTML = `                    <div class="status error">                        ‚úÖ Bot√£o CORRETAMENTE desabilitado<br>                        Texto: "${btn.textContent}"                    </div>                `;            } else if (btn.textContent === 'Comprar Cr√©ditos') {                resultDiv.innerHTML = `                    <div class="status warning">                        ‚úÖ Bot√£o alterado para compra de cr√©ditos<br>                        Texto: "${btn.textContent}"                    </div>                `;            } else {                resultDiv.innerHTML = `                    <div class="status success">                        ‚úÖ Bot√£o habilitado (usu√°rio tem cr√©ditos)<br>                        Texto: "${btn.textContent}"                    </div>                `;            }        }

        // Configurar bot√£o de teste similar ao da p√°gina analisar
        document.getElementById('testAnalyzeBtn').addEventListener('click', function () {
            const user = JSON.parse(localStorage.getItem('user') || 'null');
            const isGiftCodeUser = localStorage.getItem('isGiftCodeUser') === 'true';
            const resultDiv = document.getElementById('analyze-result');

            if (!user && !isGiftCodeUser) {
                resultDiv.innerHTML = '<div class="status error">‚ùå Erro: Voc√™ precisa fazer login</div>';
                return;
            }

            if (user && !isGiftCodeUser && user.credits <= 0) {
                resultDiv.innerHTML = '<div class="status error">‚ùå Erro: Sem an√°lises dispon√≠veis</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="status success">‚úÖ An√°lise seria permitida</div>';
        });

        // Fun√ß√£o global para ser chamada pelo header.js
        window.updateAnalyzeButton = function () {
            const btn = document.getElementById('testAnalyzeBtn');
            if (!btn) return;

            const user = JSON.parse(localStorage.getItem('user') || 'null');
            const isGiftCodeUser = localStorage.getItem('isGiftCodeUser') === 'true';

            if (!user && !isGiftCodeUser) {
                btn.disabled = true;
                btn.textContent = 'Fa√ßa login para analisar';
                btn.style.opacity = '0.6';
                btn.style.cursor = 'not-allowed';
                return;
            }

            if (user && !isGiftCodeUser && user.credits <= 0) { btn.disabled = false; btn.textContent = 'Comprar Cr√©ditos'; btn.style.opacity = '1'; btn.style.cursor = 'pointer'; return; }

            btn.disabled = false;
            btn.textContent = 'Analisar Curr√≠culo';
            btn.style.opacity = '1';
            btn.style.cursor = 'pointer';
        };

        // Inicializar quando p√°gina carregar
        setTimeout(() => {
            updateUserInfo();
            refreshInterface();
        }, 500);

        console.log('üß™ P√°gina de teste carregada - simule diferentes estados de cr√©ditos');
    </script>
</body>

</html>