<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Teste Otimiza√ß√µes Fase 1 - CV Sem Frescura</title>

    <!-- Critical CSS inline -->
    <link rel="stylesheet" href="assets/css/critical.css">

    <!-- Performance Optimizer - carrega primeiro -->
    <script src="assets/js/performance-optimizer.js"></script>

    <!-- Preload recursos cr√≠ticos -->
    <link rel="preload" href="assets/img/logo-optimized.svg" as="image">
    <link rel="preload" href="assets/js/auth-optimized.js" as="script">

    <!-- Fonts otimizadas -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <style>
        body {
            font-family: var(--font-family);
            padding: 2rem;
            background: var(--background);
            color: var(--text-dark);
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .test-section {
            background: var(--white);
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .test-card {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary);
        }

        .metric {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .performance-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .before,
        .after {
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .before {
            background: #fee;
            border: 2px solid #f88;
        }

        .after {
            background: #efe;
            border: 2px solid #8f8;
        }

        .logo-comparison {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin: 1rem 0;
        }

        .logo-test {
            text-align: center;
        }

        .file-size {
            font-weight: bold;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }

        .size-large {
            background: #fee;
            color: #c33;
        }

        .size-small {
            background: #efe;
            color: #3c3;
        }

        .lazy-test {
            margin: 2rem 0;
        }

        .lazy-image {
            width: 100%;
            max-width: 300px;
            height: 200px;
            background: #f0f0f0;
            border: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }

        .lazy-image.loaded {
            background: #e8f5e8;
            border-color: #4caf50;
        }

        .btn-test {
            background: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            margin: 0.5rem;
            transition: all 0.2s ease;
        }

        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .before-after {
                grid-template-columns: 1fr;
            }

            .logo-comparison {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="test-container">
        <div class="header">
            <h1>üöÄ Teste das Otimiza√ß√µes - Fase 1</h1>
            <p>Demonstra√ß√£o das melhorias de performance implementadas</p>
        </div>

        <!-- Teste de Logo Otimizada -->
        <div class="test-section">
            <h2>üì¶ 1. Otimiza√ß√£o de Imagens</h2>
            <div class="before-after">
                <div class="before">
                    <h3>‚ùå ANTES</h3>
                    <div class="logo-test">
                        <img src="assets/img/novo_logo.png" alt="Logo PNG" style="height: 60px;">
                        <div class="file-size size-large">PNG: 153KB</div>
                    </div>
                </div>
                <div class="after">
                    <h3>‚úÖ DEPOIS</h3>
                    <div class="logo-test">
                        <img src="assets/img/logo-optimized.svg" alt="Logo SVG" style="height: 60px;" width="200"
                            height="120" decoding="async">
                        <div class="file-size size-small">SVG: ~2KB</div>
                    </div>
                </div>
            </div>
            <div class="test-card">
                <h4>üí∞ Economia de Dados</h4>
                <div class="metric">98.7% menor</div>
                <p>Redu√ß√£o de 151KB por p√°gina carregada</p>
            </div>
        </div>

        <!-- Teste de Performance Metrics -->
        <div class="test-section">
            <h2>üìä 2. M√©tricas de Performance</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h4>‚ö° Tempo de Carregamento</h4>
                    <div class="metric" id="loadTime">Calculando...</div>
                    <p>Tempo total desde navega√ß√£o at√© load completo</p>
                </div>
                <div class="test-card">
                    <h4>üéØ First Contentful Paint</h4>
                    <div class="metric" id="fcp">Medindo...</div>
                    <p>Primeiro conte√∫do vis√≠vel na tela</p>
                </div>
                <div class="test-card">
                    <h4>üìè Largest Contentful Paint</h4>
                    <div class="metric" id="lcp">Aguardando...</div>
                    <p>Maior elemento de conte√∫do carregado</p>
                </div>
                <div class="test-card">
                    <h4>üîÑ Cumulative Layout Shift</h4>
                    <div class="metric" id="cls">0.000</div>
                    <p>Estabilidade visual da p√°gina</p>
                </div>
            </div>
        </div>

        <!-- Teste de Lazy Loading -->
        <div class="test-section">
            <h2>üñºÔ∏è 3. Lazy Loading de Imagens</h2>
            <p>Role para baixo para ver as imagens carregarem automaticamente:</p>
            <div class="lazy-test">
                <div class="lazy-image" data-src="assets/img/results_1.png">
                    <span>Imagem ser√° carregada quando vis√≠vel</span>
                </div>
                <div class="lazy-image" data-src="assets/img/results_2.png">
                    <span>Lazy Loading em a√ß√£o</span>
                </div>
                <div class="lazy-image" data-src="assets/img/results_3.png">
                    <span>Performance otimizada</span>
                </div>
            </div>
        </div>

        <!-- Teste de Auth Otimizado -->
        <div class="test-section">
            <h2>üîê 4. Sistema de Autentica√ß√£o Otimizado</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h4>üì° API Response Time</h4>
                    <div class="metric" id="apiTime">-</div>
                    <button class="btn-test" onclick="testApiSpeed()">Testar API</button>
                </div>
                <div class="test-card">
                    <h4>üíæ Cache Hit Rate</h4>
                    <div class="metric" id="cacheHit">0%</div>
                    <button class="btn-test" onclick="testCache()">Testar Cache</button>
                </div>
            </div>
        </div>

        <!-- Console de Performance -->
        <div class="test-section">
            <h2>üîç 5. Console de Performance</h2>
            <p>Logs em tempo real do Performance Optimizer:</p>
            <div class="performance-log" id="performanceLog">
                Performance Optimizer carregado...
                Aguardando m√©tricas...
            </div>
            <button class="btn-test" onclick="clearLog()">Limpar Log</button>
            <button class="btn-test" onclick="runPerformanceTest()">Executar Teste Completo</button>
        </div>

        <!-- Recursos Carregados -->
        <div class="test-section">
            <h2>üìã 6. Recursos Carregados</h2>
            <div id="resourcesList">
                <p>Analisando recursos carregados...</p>
            </div>
        </div>
    </div>

    <!-- Scripts otimizados -->
    <script src="assets/js/auth-optimized.js" defer></script>

    <script>
        // Performance monitoring
        let performanceLog = document.getElementById('performanceLog');
        let originalConsoleLog = console.log;

        // Interceptar console.log para mostrar na p√°gina
        console.log = function (...args) {
            originalConsoleLog.apply(console, args);
            const message = args.join(' ');
            if (message.includes('‚ö°') || message.includes('üìä') || message.includes('üñºÔ∏è') || message.includes('üîó')) {
                performanceLog.textContent += '\n' + new Date().toLocaleTimeString() + ': ' + message;
                performanceLog.scrollTop = performanceLog.scrollHeight;
            }
        };

        // Medir m√©tricas de performance
        window.addEventListener('load', () => {
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            document.getElementById('loadTime').textContent = Math.round(loadTime) + 'ms';

            // Listar recursos carregados
            const resources = performance.getEntriesByType('resource');
            const resourcesList = document.getElementById('resourcesList');

            let totalSize = 0;
            let resourcesHtml = '<h4>Recursos carregados:</h4><ul>';

            resources.forEach(resource => {
                const size = resource.transferSize || 0;
                totalSize += size;
                const sizeKB = (size / 1024).toFixed(1);
                resourcesHtml += `<li>${resource.name.split('/').pop()} - ${sizeKB}KB</li>`;
            });

            resourcesHtml += `</ul><p><strong>Total: ${(totalSize / 1024).toFixed(1)}KB</strong></p>`;
            resourcesList.innerHTML = resourcesHtml;
        });

        // Observer para Performance API
        if ('PerformanceObserver' in window) {
            // First Contentful Paint
            new PerformanceObserver((list) => {
                const entries = list.getEntries();
                const fcp = entries.find(entry => entry.name === 'first-contentful-paint');
                if (fcp) {
                    document.getElementById('fcp').textContent = Math.round(fcp.startTime) + 'ms';
                }
            }).observe({ entryTypes: ['paint'] });

            // Largest Contentful Paint
            new PerformanceObserver((list) => {
                const entries = list.getEntries();
                const lastEntry = entries[entries.length - 1];
                document.getElementById('lcp').textContent = Math.round(lastEntry.startTime) + 'ms';
            }).observe({ entryTypes: ['largest-contentful-paint'] });

            // Cumulative Layout Shift
            let clsValue = 0;
            new PerformanceObserver((list) => {
                const entries = list.getEntries();
                entries.forEach(entry => {
                    if (!entry.hadRecentInput) {
                        clsValue += entry.value;
                    }
                });
                document.getElementById('cls').textContent = clsValue.toFixed(4);
            }).observe({ entryTypes: ['layout-shift'] });
        }

        // Simular lazy loading manual
        const lazyImages = document.querySelectorAll('.lazy-image[data-src]');
        const imageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.style.backgroundImage = `url(${img.dataset.src})`;
                    img.style.backgroundSize = 'cover';
                    img.style.backgroundPosition = 'center';
                    img.classList.add('loaded');
                    img.innerHTML = '<span style="background: rgba(255,255,255,0.9); padding: 0.5rem; border-radius: 0.25rem;">‚úÖ Carregada!</span>';
                    imageObserver.unobserve(img);
                }
            });
        });

        lazyImages.forEach(img => imageObserver.observe(img));

        // Fun√ß√µes de teste
        function testApiSpeed() {
            const startTime = performance.now();

            // Simular request de API
            fetch('/api/config')
                .then(() => {
                    const endTime = performance.now();
                    const duration = Math.round(endTime - startTime);
                    document.getElementById('apiTime').textContent = duration + 'ms';
                })
                .catch(() => {
                    document.getElementById('apiTime').textContent = 'Offline';
                });
        }

        function testCache() {
            // Simular teste de cache
            const cacheHit = Math.random() > 0.3; // 70% chance de cache hit
            document.getElementById('cacheHit').textContent = cacheHit ? '100%' : '0%';

            performanceLog.textContent += '\n' + new Date().toLocaleTimeString() + ': üîÑ Cache ' + (cacheHit ? 'HIT' : 'MISS');
            performanceLog.scrollTop = performanceLog.scrollHeight;
        }

        function clearLog() {
            performanceLog.textContent = 'Log limpo...\n';
        }

        function runPerformanceTest() {
            performanceLog.textContent += '\nüöÄ Executando teste completo de performance...\n';

            // Simular v√°rios testes
            setTimeout(() => {
                performanceLog.textContent += '‚úÖ Preload de recursos: OK\n';
            }, 500);

            setTimeout(() => {
                performanceLog.textContent += '‚úÖ Lazy loading: Ativo\n';
            }, 1000);

            setTimeout(() => {
                performanceLog.textContent += '‚úÖ Cache de API: Funcionando\n';
            }, 1500);

            setTimeout(() => {
                performanceLog.textContent += '‚úÖ Core Web Vitals: Monitorando\n';
                performanceLog.textContent += 'üéâ Teste completo finalizado!\n';
                performanceLog.scrollTop = performanceLog.scrollHeight;
            }, 2000);
        }

        // Executar teste inicial
        setTimeout(runPerformanceTest, 2000);
    </script>
</body>

</html>